<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>Avgångar från Råcksta – Tunnelbanan</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f4f4f4;
        }
        h1 {
            color: #333;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            background: white;
            margin-bottom: 10px;
            padding: 10px;
            border-left: 5px solid #0078D7;
        }
    </style>
</head>
<body>
    <h1>Avgångar från Råcksta – Tunnelbanan</h1>
    <ul id="departure-list">
        <li>Laddar avgångar...</li>
    </ul>

    <script>
        async function getDepartures() {
            const apiUrl = "https://transport.integration.sl.se/v1/sites/9104/departures";
            const list = document.getElementById("departure-list");
            list.innerHTML = "<li>Laddar avgångar...</li>";

            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                const now = new Date();

                const line17Departures = data.departures
                    .filter(dep => dep.line.designation === "17" && dep.expected)
                    .map(dep => {
                        const expectedTime = new Date(dep.expected);
                        const minutesLeft = Math.round((expectedTime - now) / 60000);
                        return {
                            destination: dep.destination,
                            minutesLeft: minutesLeft,
                            display: dep.display
                        };
                    })
                    .sort((a, b) => a.minutesLeft - b.minutesLeft);

                list.innerHTML = "";

                if (line17Departures.length === 0) {
                    list.innerHTML = "<li>Inga avgångar för linje 17 just nu.</li>";
                } else {
                    line17Departures.forEach(dep => {
                        const li = document.createElement("li");
                        li.textContent = `Mot ${dep.destination} – (${dep.display})`;
                        list.appendChild(li);
                    });
                }

            } catch (error) {
                list.innerHTML = `<li>Fel vid hämtning av data: ${error.message}</li>`;
                console.error("Fel vid hämtning av avgångar:", error);
            }
        }

        // Kör direkt och uppdatera var 30:e sekund
        getDepartures();
        setInterval(getDepartures, 30000);
    </script>
</body>
</html>
